import React from "react";
import { useContext } from "react";
import { Link } from "react-router-dom";
import { AuthContext } from "../context/AuthContext";
const UserDropdown = () => {
  const { user, logout } = useContext(AuthContext);

  const handleLogout = async () => {
    const result = await logout();
    if (result.success) {
      window.location.href = "/";
    } else {
      alert(result.message);
    }
  };
  return (
    <>
      {user ? (
        // User is logged in, show full name and dropdown
        <div className="dropdown dropdown-end dropdown-hover">
          <div
            tabIndex={0}
            role="button"
            className="btn btn-ghost avatar flex items-center space-x-1"
          >
            <div className="avatar placeholder">
              <svg
                className="h-8 w-8"
                viewBox="0 0 38 38"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M37.3409 18.9815C37.3409 8.77875 29.0529 0.5 18.8409 0.5C8.62894 0.5 0.340942 8.77875 0.340942 18.9815C0.340942 24.6009 2.89394 29.6652 6.88994 33.0646C6.92694 33.1016 6.96394 33.1016 6.96394 33.1386C7.29694 33.3976 7.62994 33.6566 7.99994 33.9156C8.18494 34.0266 8.33294 34.1723 8.51794 34.3203C11.5765 36.3906 15.1846 37.498 18.8779 37.5C22.5712 37.498 26.1794 36.3906 29.2379 34.3203C29.4229 34.2093 29.5709 34.0636 29.7559 33.9503C30.0889 33.6936 30.4589 33.4346 30.7919 33.1756C30.8289 33.1386 30.8659 33.1386 30.8659 33.1016C34.7879 29.6629 37.3409 24.6009 37.3409 18.9815ZM18.8409 35.1713C15.3629 35.1713 12.1809 34.0613 9.55394 32.2136C9.59094 31.9176 9.66494 31.6239 9.73894 31.3279C9.96014 30.526 10.2835 29.7558 10.7009 29.0363C11.1079 28.3333 11.5889 27.7043 12.1809 27.1493C12.7359 26.5943 13.4019 26.0786 14.0679 25.6716C14.7709 25.2646 15.5109 24.9686 16.3249 24.7466C17.1455 24.5268 17.9914 24.4156 18.8409 24.4159C21.3633 24.3968 23.7932 25.3644 25.6119 27.1123C26.4629 27.9633 27.1289 28.9615 27.6099 30.1069C27.8689 30.7729 28.0539 31.4752 28.1649 32.2136C25.4343 34.1334 22.1789 35.166 18.8409 35.1713ZM13.1799 18.0588C12.8546 17.3122 12.6907 16.5052 12.6989 15.6908C12.6989 14.8791 12.8469 14.0651 13.1799 13.3251C13.5129 12.5851 13.9569 11.9214 14.5119 11.3664C15.0669 10.8114 15.7329 10.3698 16.4729 10.0368C17.2129 9.70375 18.0269 9.55575 18.8409 9.55575C19.6919 9.55575 20.4689 9.70375 21.2089 10.0368C21.9489 10.3698 22.6149 10.8137 23.1699 11.3664C23.7249 11.9214 24.1689 12.5874 24.5019 13.3251C24.8349 14.0651 24.9829 14.8791 24.9829 15.6908C24.9829 16.5418 24.8349 17.3188 24.5019 18.0565C24.1824 18.7866 23.7308 19.4514 23.1699 20.0175C22.6036 20.5776 21.9388 21.0283 21.2089 21.3472C19.6797 21.9743 17.9652 21.9743 16.4359 21.3472C15.7061 21.0283 15.0413 20.5776 14.4749 20.0175C13.9136 19.4594 13.4728 18.7942 13.1799 18.0588ZM30.3479 30.3289C30.3479 30.2549 30.3109 30.2179 30.3109 30.1439C29.9477 28.9861 29.4113 27.8899 28.7199 26.8926C28.028 25.8879 27.1784 25.0016 26.2039 24.2679C25.4595 23.7076 24.6524 23.2358 23.7989 22.8619C24.1854 22.6033 24.5449 22.3066 24.8719 21.9762C25.4236 21.4316 25.908 20.8229 26.3149 20.1632C27.1372 18.8181 27.5606 17.2671 27.5359 15.6908C27.548 14.5241 27.3214 13.3673 26.8699 12.2914C26.4248 11.2546 25.7841 10.3133 24.9829 9.51875C24.181 8.73493 23.2399 8.10753 22.2079 7.66875C21.1305 7.21747 19.972 6.9916 18.8039 7.00506C17.6357 6.99234 16.4772 7.21899 15.3999 7.67106C14.3566 8.10449 13.4125 8.74574 12.6249 9.55575C11.837 10.3535 11.2091 11.2946 10.7749 12.3284C10.3235 13.4043 10.0968 14.5611 10.1089 15.7278C10.1089 16.5418 10.2199 17.318 10.4419 18.0565C10.6639 18.8335 10.9599 19.5365 11.3669 20.2002C11.7369 20.8662 12.2549 21.4582 12.8099 22.0132C13.1429 22.3462 13.5129 22.6414 13.9199 22.8989C13.0627 23.2805 12.2551 23.7651 11.5149 24.3419C10.5529 25.0819 9.70194 25.9676 8.99894 26.9296C8.3012 27.9231 7.76429 29.0203 7.40794 30.1809C7.37094 30.2549 7.37094 30.3289 7.37094 30.3659C4.44794 27.4082 2.63494 23.4169 2.63494 18.9815C2.63494 10.0738 9.92394 2.79169 18.8409 2.79169C27.7579 2.79169 35.0469 10.0738 35.0469 18.9815C35.0421 23.2364 33.3526 27.3163 30.3479 30.3289Z"
                  fill="#1126EA"
                />
              </svg>
            </div>
            <span className="hidden md:inline">
              Здравей, {user.fullName.split(" ")[0]}
            </span>
          </div>
          <ul
            tabIndex={0}
            className="menu menu-sm dropdown-content bg-base-100 bg-white rounded-box z-[1] mt-1 w-52 p-2 shadow"
          >
            <li>
              <a>Моят Акаунт</a>
            </li>
            <li>
              <a href="/my-orders">Моите Поръчки</a>
            </li>
            <li>
              <a>Моите Абонаменти</a>
            </li>
            <li>
              <button onClick={handleLogout}>Изход</button>
            </li>
          </ul>
        </div>
      ) : (
        // User is not logged in, show "Моят акаунт" without dropdown
        <Link to="/auth">
          <div
            tabIndex={0}
            role="button"
            className="btn btn-ghost avatar flex items-center space-x-1"
          >
            <div className="avatar placeholder">
              <svg
                className="h-8 w-8"
                viewBox="0 0 38 38"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M37.3409 18.9815C37.3409 8.77875 29.0529 0.5 18.8409 0.5C8.62894 0.5 0.340942 8.77875 0.340942 18.9815C0.340942 24.6009 2.89394 29.6652 6.88994 33.0646C6.92694 33.1016 6.96394 33.1016 6.96394 33.1386C7.29694 33.3976 7.62994 33.6566 7.99994 33.9156C8.18494 34.0266 8.33294 34.1723 8.51794 34.3203C11.5765 36.3906 15.1846 37.498 18.8779 37.5C22.5712 37.498 26.1794 36.3906 29.2379 34.3203C29.4229 34.2093 29.5709 34.0636 29.7559 33.9503C30.0889 33.6936 30.4589 33.4346 30.7919 33.1756C30.8289 33.1386 30.8659 33.1386 30.8659 33.1016C34.7879 29.6629 37.3409 24.6009 37.3409 18.9815ZM18.8409 35.1713C15.3629 35.1713 12.1809 34.0613 9.55394 32.2136C9.59094 31.9176 9.66494 31.6239 9.73894 31.3279C9.96014 30.526 10.2835 29.7558 10.7009 29.0363C11.1079 28.3333 11.5889 27.7043 12.1809 27.1493C12.7359 26.5943 13.4019 26.0786 14.0679 25.6716C14.7709 25.2646 15.5109 24.9686 16.3249 24.7466C17.1455 24.5268 17.9914 24.4156 18.8409 24.4159C21.3633 24.3968 23.7932 25.3644 25.6119 27.1123C26.4629 27.9633 27.1289 28.9615 27.6099 30.1069C27.8689 30.7729 28.0539 31.4752 28.1649 32.2136C25.4343 34.1334 22.1789 35.166 18.8409 35.1713ZM13.1799 18.0588C12.8546 17.3122 12.6907 16.5052 12.6989 15.6908C12.6989 14.8791 12.8469 14.0651 13.1799 13.3251C13.5129 12.5851 13.9569 11.9214 14.5119 11.3664C15.0669 10.8114 15.7329 10.3698 16.4729 10.0368C17.2129 9.70375 18.0269 9.55575 18.8409 9.55575C19.6919 9.55575 20.4689 9.70375 21.2089 10.0368C21.9489 10.3698 22.6149 10.8137 23.1699 11.3664C23.7249 11.9214 24.1689 12.5874 24.5019 13.3251C24.8349 14.0651 24.9829 14.8791 24.9829 15.6908C24.9829 16.5418 24.8349 17.3188 24.5019 18.0565C24.1824 18.7866 23.7308 19.4514 23.1699 20.0175C22.6036 20.5776 21.9388 21.0283 21.2089 21.3472C19.6797 21.9743 17.9652 21.9743 16.4359 21.3472C15.7061 21.0283 15.0413 20.5776 14.4749 20.0175C13.9136 19.4594 13.4728 18.7942 13.1799 18.0588ZM30.3479 30.3289C30.3479 30.2549 30.3109 30.2179 30.3109 30.1439C29.9477 28.9861 29.4113 27.8899 28.7199 26.8926C28.028 25.8879 27.1784 25.0016 26.2039 24.2679C25.4595 23.7076 24.6524 23.2358 23.7989 22.8619C24.1854 22.6033 24.5449 22.3066 24.8719 21.9762C25.4236 21.4316 25.908 20.8229 26.3149 20.1632C27.1372 18.8181 27.5606 17.2671 27.5359 15.6908C27.548 14.5241 27.3214 13.3673 26.8699 12.2914C26.4248 11.2546 25.7841 10.3133 24.9829 9.51875C24.181 8.73493 23.2399 8.10753 22.2079 7.66875C21.1305 7.21747 19.972 6.9916 18.8039 7.00506C17.6357 6.99234 16.4772 7.21899 15.3999 7.67106C14.3566 8.10449 13.4125 8.74574 12.6249 9.55575C11.837 10.3535 11.2091 11.2946 10.7749 12.3284C10.3235 13.4043 10.0968 14.5611 10.1089 15.7278C10.1089 16.5418 10.2199 17.318 10.4419 18.0565C10.6639 18.8335 10.9599 19.5365 11.3669 20.2002C11.7369 20.8662 12.2549 21.4582 12.8099 22.0132C13.1429 22.3462 13.5129 22.6414 13.9199 22.8989C13.0627 23.2805 12.2551 23.7651 11.5149 24.3419C10.5529 25.0819 9.70194 25.9676 8.99894 26.9296C8.3012 27.9231 7.76429 29.0203 7.40794 30.1809C7.37094 30.2549 7.37094 30.3289 7.37094 30.3659C4.44794 27.4082 2.63494 23.4169 2.63494 18.9815C2.63494 10.0738 9.92394 2.79169 18.8409 2.79169C27.7579 2.79169 35.0469 10.0738 35.0469 18.9815C35.0421 23.2364 33.3526 27.3163 30.3479 30.3289Z"
                  fill="#1126EA"
                />
              </svg>
            </div>
            <span className="hidden md:inline">Влез в профила си</span>
          </div>
        </Link>
      )}
    </>
  );
};

export default UserDropdown;
